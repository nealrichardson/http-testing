<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 25 security | HTTP testing in R</title>
<meta name="author" content="Scott Chamberlain, Maëlle Salmon">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><div class="inline-figure"><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></div></noscript>
<!-- End Matomo Code --><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">HTTP testing in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preamble</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="http-in-r-101.html"><span class="header-section-number">2</span> HTTP in R 101</a></li>
<li><a class="" href="graceful.html"><span class="header-section-number">3</span> Graceful HTTP R packages</a></li>
<li><a class="" href="pkgs-testing-chapter.html"><span class="header-section-number">4</span> Packages for HTTP testing</a></li>
<li class="book-part">Whole Game(s)</li>
<li><a class="" href="introduction.html"><span class="header-section-number">5</span> Introduction</a></li>
<li><a class="" href="vcr.html"><span class="header-section-number">6</span> Use vcr (&amp; webmockr)</a></li>
<li><a class="" href="httptest.html"><span class="header-section-number">7</span> Use httptest</a></li>
<li><a class="" href="mocking-pkgs-comparison.html"><span class="header-section-number">8</span> vcr and httptest</a></li>
<li><a class="" href="webfakes.html"><span class="header-section-number">9</span> Use webfakes</a></li>
<li><a class="" href="pkgs-comparison.html"><span class="header-section-number">10</span> vcr (&amp; webmockr), httptest, webfakes</a></li>
<li class="book-part">Advanced Topics</li>
<li><a class="" href="real-requests-chapter.html"><span class="header-section-number">11</span> Making real requests</a></li>
<li><a class="" href="cran-preparedness.html"><span class="header-section-number">12</span> CRAN- (and Bioconductor) preparedness for your tests</a></li>
<li><a class="" href="security-chapter.html"><span class="header-section-number">13</span> Security</a></li>
<li><a class="" href="errors-chapter.html"><span class="header-section-number">14</span> Faking HTTP errors</a></li>
<li class="book-part">webmockr</li>
<li><a class="" href="mocking.html"><span class="header-section-number">15</span> Mocking HTTP Requests</a></li>
<li><a class="" href="webmockr-stubs.html"><span class="header-section-number">16</span> stubs</a></li>
<li><a class="" href="webmockr-testing.html"><span class="header-section-number">17</span> testing</a></li>
<li><a class="" href="webmockr-utilities.html"><span class="header-section-number">18</span> utilities</a></li>
<li class="book-part">vcr</li>
<li><a class="" href="vcr-intro.html"><span class="header-section-number">19</span> Caching HTTP requests</a></li>
<li><a class="" href="vcr-usage.html"><span class="header-section-number">20</span> vcr advanced usage</a></li>
<li><a class="" href="vcr-configuration.html"><span class="header-section-number">21</span> vcr configuration</a></li>
<li><a class="" href="record-modes.html"><span class="header-section-number">22</span> record modes</a></li>
<li><a class="" href="request-matching.html"><span class="header-section-number">23</span> request matching</a></li>
<li><a class="" href="debugging-your-tests-that-use-vcr.html"><span class="header-section-number">24</span> Debugging your tests that use vcr</a></li>
<li><a class="active" href="vcr-security.html"><span class="header-section-number">25</span> security</a></li>
<li><a class="" href="lightswitch.html"><span class="header-section-number">26</span> Turning vcr on &amp; off</a></li>
<li><a class="" href="managing-cassettes.html"><span class="header-section-number">27</span> managing cassettes</a></li>
<li><a class="" href="gotchas.html"><span class="header-section-number">28</span> gotchas</a></li>
<li><a class="" href="session-info.html"><span class="header-section-number">29</span> Session info</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div class="alert alert-dismissible alert-warning">
⚠️ We are currently working on improvements of this book. Watch the <a href="https://github.com/ropensci-books/http-testing">GitHub repository</a> or wait for a release announcement on <a href="https://ropensci.org/archive">rOpenSci blog</a>.
</div>
<div id="vcr-security" class="section level1" number="25">
<h1>
<span class="header-section-number">25</span> security<a class="anchor" aria-label="anchor" href="#vcr-security"><i class="fas fa-link"></i></a>
</h1>
<p>Refer to <a href="security-chapter.html#security-chapter">the security chapter</a> for more general guidance.</p>
<div id="api-keys-security" class="section level2" number="25.1">
<h2>
<span class="header-section-number">25.1</span> API keys and such<a class="anchor" aria-label="anchor" href="#api-keys-security"><i class="fas fa-link"></i></a>
</h2>
<p>The configuration parameter <code>filter_sensitive_data</code> accepts a named list.</p>
<p>Each element in the list should be of the following format:</p>
<p><code>thing_to_replace_it_with = thing_to_replace</code></p>
<p>We replace all instances of <code>thing_to_replace</code> with <code>thing_to_replace_it_with</code>.</p>
<p>Before recording (writing to a cassette) we do the replacement and then when
reading from the cassette we do the reverse replacement to get back
to the real data.</p>
<p>The before record replacement happens in an internal
function <code>write_interactions()</code>, while before playback replacement
happens in internal function <code>YAML$deserialize_path()</code></p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/vcr/reference/vcr_configure.html">vcr_configure</a></span><span class="op">(</span>
  filter_sensitive_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"&lt;&lt;&lt;my_api_key&gt;&gt;&gt;"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">'API_KEY'</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>You want to make the string that replaces your sensitive string something that
won’t be easily found elsewhere in the response body/headers/etc.</p>
<p>It’s a good idea to not in place of <code>thing_to_replace</code> put your actual sensitive
key thing, because that defeats the purpose of trying to protect your private
data. This is why we highly recommend setting your API keys as environment
variables, then you can as seen above just put a call to <code><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv()</a></code>,
which we’ll use internally to get your key, find it anywhere in the HTTP
responses, and replace it with your placeholder string.</p>
<p>The reason you want to do this is because you may on purpose or on accident
push your cassettes to the public web, and when that happens you don’t want
your private keys in those cassettes.</p>
<p>Note that the way this is implemented in <code>vcr</code> is not super elegant and is
not general with respect to the serializer. We only support YAML serializing
right now, but when we support other serializers we’ll need to change the
implementation.</p>
</div>
<div id="different-api-keys" class="section level2" number="25.2">
<h2>
<span class="header-section-number">25.2</span> API keys and tests run in varied contexts<a class="anchor" aria-label="anchor" href="#different-api-keys"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>For real requests a real API key is needed.</li>
<li>For requests using cassettes a fake API key is needed to fool your package. That is
why in our <a href="vcr.html#vcr">demo of vcr</a> we set a fake API key in a test setup file.</li>
</ul>
</div>
<div id="other-security" class="section level2" number="25.3">
<h2>
<span class="header-section-number">25.3</span> Other security<a class="anchor" aria-label="anchor" href="#other-security"><i class="fas fa-link"></i></a>
</h2>
<p>Let us know about any other security concerns! Surely there’s things we haven’t
considered yet.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="debugging-your-tests-that-use-vcr.html"><span class="header-section-number">24</span> Debugging your tests that use vcr</a></div>
<div class="next"><a href="lightswitch.html"><span class="header-section-number">26</span> Turning vcr on &amp; off</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#vcr-security"><span class="header-section-number">25</span> security</a></li>
<li><a class="nav-link" href="#api-keys-security"><span class="header-section-number">25.1</span> API keys and such</a></li>
<li><a class="nav-link" href="#different-api-keys"><span class="header-section-number">25.2</span> API keys and tests run in varied contexts</a></li>
<li><a class="nav-link" href="#other-security"><span class="header-section-number">25.3</span> Other security</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>HTTP testing in R</strong>" was written by Scott Chamberlain, Maëlle Salmon. It was last built on built on 2020-12-14.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
